<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Usage Summary - ID Registration System</title>
  <meta name="description" content="Usage Summary - Monitor AI headshot generation usage and rate limits">
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="stylesheet" href="/static/dashboard.css">
</head>
<body class="dashboard-body">
  <div class="dashboard-container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
          <div class="logo-icon">
            <svg width="32" height="32" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect width="40" height="40" rx="10" fill="#2e7d32"/>
              <path d="M12 14h16v2H12zM12 19h10v2H12zM12 24h12v2H12zM26 18h4v10h-4z" fill="white"/>
              <circle cx="28" cy="14" r="3" fill="white"/>
            </svg>
          </div>
          <span>ID System</span>
        </a>
      </div>
      <nav class="sidebar-nav">
        <a href="/hr/dashboard" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="2" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5"/>
            <rect x="11" y="2" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5"/>
            <rect x="2" y="11" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5"/>
            <rect x="11" y="11" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          Dashboard
        </a>
        <a href="/hr/gallery" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="3" width="16" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="7" cy="8" r="2" stroke="currentColor" stroke-width="1.5"/>
            <path d="M2 14l4-4 3 3 4-4 5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          ID Gallery
        </a>
        <a href="/hr/usage" class="nav-item active">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="12" width="3" height="6" rx="0.5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="7" y="8" width="3" height="10" rx="0.5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="12" y="4" width="3" height="14" rx="0.5" stroke="currentColor" stroke-width="1.5"/>
            <path d="M2 2h16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Usage
        </a>
        <a href="/" class="nav-item">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 10l7-7 7 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 8v9h10V8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Home
        </a>
        <a href="/hr/logout" class="nav-item logout">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 17H4a2 2 0 01-2-2V5a2 2 0 012-2h3M14 14l4-4-4-4M18 10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Logout
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="content-header">
        <div class="header-title">
          <h1>Usage Summary</h1>
          <p>Monitor AI headshot generation usage &amp; rate limits</p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="resetAllBtn" style="background: #e65100; color: white; border-color: #e65100;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3.51 15a9 9 0 105.64-9.94L1 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Reset All Limits
          </button>
          <button class="btn btn-secondary" id="refreshUsageBtn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5" fill="none"/>
              <path d="M12 4a6 6 0 00-8 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M14 6l-2.5-2.5.5 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" fill="none"/>
            </svg>
            Refresh
          </button>
        </div>
      </header>

      <!-- Summary Cards -->
      <section class="status-cards">
        <div class="status-card total">
          <div class="status-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="status-info">
            <span class="status-value" id="totalUsers">-</span>
            <span class="status-label">Active Users</span>
          </div>
        </div>
        <div class="status-card reviewing">
          <div class="status-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
              <path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="status-info">
            <span class="status-value" id="totalGenerations">-</span>
            <span class="status-label">Total Generations</span>
          </div>
        </div>
        <div class="status-card approved">
          <div class="status-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" stroke="currentColor" stroke-width="2"/>
              <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="status-info">
            <span class="status-value" id="usageLimit">-</span>
            <span class="status-label">Limit Per User</span>
          </div>
        </div>
        <div class="status-card completed">
          <div class="status-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="status-info">
            <span class="status-value" id="rateLimitedCount">-</span>
            <span class="status-label">Rate Limited</span>
          </div>
        </div>
      </section>

      <!-- Search -->
      <section class="search-section">
        <div class="search-bar">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="2"/>
            <path d="M13.5 13.5L17 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input type="text" id="usageSearchInput" placeholder="Search by name or Lark User ID...">
        </div>
        <div class="filter-group">
          <select id="usageFilter">
            <option value="">All Users</option>
            <option value="rate-limited">Rate Limited Only</option>
            <option value="active">Has Remaining</option>
          </select>
        </div>
      </section>

      <!-- Loading State -->
      <div class="loading-state" id="loadingState">
        <div class="loading-spinner"></div>
        <p>Loading usage data...</p>
      </div>

      <!-- Usage Table -->
      <section class="table-section" id="tableSection" style="display: none;">
        <div class="table-header">
          <h2>AI Headshot Usage</h2>
          <span class="table-count" id="tableCount">0 users</span>
        </div>
        <div class="table-wrapper">
          <table class="employee-table" id="usageTable">
            <thead>
              <tr>
                <th>Lark Name</th>
                <th>Lark User ID</th>
                <th>Generations Used</th>
                <th>Remaining</th>
                <th>Usage</th>
                <th>Last Used</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usageTableBody">
              <!-- Data will be populated via JavaScript -->
            </tbody>
          </table>
        </div>
        <div class="empty-state" id="emptyState" style="display: none;">
          <svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="10" y="15" width="60" height="50" rx="4" stroke="#adb5bd" stroke-width="2"/>
            <path d="M10 30h60" stroke="#adb5bd" stroke-width="2"/>
            <rect x="20" y="40" width="10" height="15" rx="1" fill="#adb5bd"/>
            <rect x="35" y="35" width="10" height="20" rx="1" fill="#adb5bd"/>
            <rect x="50" y="45" width="10" height="10" rx="1" fill="#adb5bd"/>
          </svg>
          <h3>No Usage Data</h3>
          <p>No AI headshot generations have been recorded yet.</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon"></span>
    <span class="toast-message" id="toastMessage"></span>
  </div>

  <!-- Progress Overlay -->
  <div class="progress-overlay" id="usageProgressOverlay">
    <div class="progress-overlay-content">
      <div class="progress-spinner"></div>
      <div class="progress-bar-track">
        <div class="progress-bar-fill" id="usageProgressBarFill"></div>
      </div>
      <div class="progress-text" id="usageProgressText">Processing...</div>
      <div class="progress-subtext" id="usageProgressSubtext"></div>
    </div>
  </div>

  <!-- Confirm Reset Modal -->
  <div class="modal-overlay" id="resetModal">
    <div class="modal-content" style="max-width: 420px;">
      <div class="modal-header">
        <h2>Reset Rate Limit</h2>
        <button class="modal-close" id="closeResetModal">&times;</button>
      </div>
      <div class="modal-body" style="padding: var(--spacing-lg);">
        <p style="margin-bottom: var(--spacing-md); color: var(--color-text-secondary);">
          Are you sure you want to reset the AI headshot rate limit for this user?
        </p>
        <div style="background: var(--color-bg); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-md);">
          <strong>User ID:</strong> <code id="resetUserIdDisplay" style="color: var(--color-primary); word-break: break-all;"></code>
        </div>
        <p style="font-size: 0.85rem; color: #e65100;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="vertical-align: -2px; margin-right: 4px;">
            <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          This will allow the user to generate more AI headshots.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelResetBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmResetBtn" style="background: #e65100;">Reset Limit</button>
      </div>
    </div>
  </div>

  <!-- Confirm Reset All Modal -->
  <div class="modal-overlay" id="resetAllModal">
    <div class="modal-content" style="max-width: 420px;">
      <div class="modal-header">
        <h2>Reset All Rate Limits</h2>
        <button class="modal-close" id="closeResetAllModal">&times;</button>
      </div>
      <div class="modal-body" style="padding: var(--spacing-lg);">
        <p style="margin-bottom: var(--spacing-md); color: var(--color-text-secondary);">
          Are you sure you want to reset AI headshot rate limits for <strong>all users</strong>?
        </p>
        <p style="font-size: 0.85rem; color: #e65100;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" style="vertical-align: -2px; margin-right: 4px;">
            <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 9v4M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          This will clear all usage records and allow every user to generate AI headshots again.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelResetAllBtn">Cancel</button>
        <button class="btn btn-primary" id="confirmResetAllBtn" style="background: #e65100;">Reset All</button>
      </div>
    </div>
  </div>

  <script src="/static/usage.js?v=2"></script>
</body>
</html>
